<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Sign in or Sign up — Code & Caffeine" />
  <meta name="author" content="Harshil Mittal" />
  <title>Sign In / Sign Up — Code & Caffeine</title>
  <link rel="icon" type="image/png" href="/favicon.png" />
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
  <link as="style" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Plus+Jakarta+Sans%3Awght%40400%3B500%3B600%3B700%3B800" rel="stylesheet" onload="this.rel='stylesheet'" />
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <style type="text/tailwindcss">
    :root {
      --brand-color: #47b4ea;
      --pastel-blue: #a3d5f1;
      --pastel-pink: #f5c8d1;
      --light-background: #f0f8ff;
      --light-text-primary: #1f2937;
      --light-text-secondary: #4b5563;
      --dark-background: #111827;
      --dark-text-primary: #f9fafb;
      --dark-text-secondary: #9ca3af;
    }
    .dark {
      --background-color: var(--dark-background);
      --text-primary: var(--dark-text-primary);
      --text-secondary: var(--dark-text-secondary);
    }
    .light {
      --background-color: var(--light-background);
      --text-primary: var(--light-text-primary);
      --text-secondary: var(--light-text-secondary);
    }
    body {
      background: var(--background-color);
      color: var(--text-primary);
      font-family: 'Plus Jakarta Sans', 'Noto Sans', 'Segoe UI', Arial, sans-serif;
      min-height: 100vh;
      margin: 0;
    }
    #bg-blobs {
      position: absolute;
      inset: 0;
      z-index: 0;
      pointer-events: none;
    }
    #auth-card {
      background: rgba(255,255,255,0.95);
      border-radius: 1.5rem;
      box-shadow: 0 8px 32px 0 rgba(71,180,234,0.12), 0 1.5px 8px 0 rgba(245,200,209,0.10);
      max-width: 400px;
      width: 100%;
      margin: 0 auto;
      padding: 2.5rem 2rem 2rem 2rem;
      position: relative;
      z-index: 10;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      transition: background 0.3s, box-shadow 0.3s;
    }
    .dark #auth-card {
      background: rgba(24, 28, 38, 0.98);
      color: #f9fafb;
      box-shadow: 0 8px 32px 0 rgba(71,180,234,0.18), 0 1.5px 8px 0 rgba(245,200,209,0.13);
    }
    .auth-title {
      font-size: 2rem;
      font-weight: 700;
      color: var(--brand-color);
      margin-bottom: 0.5rem;
      letter-spacing: -0.5px;
    }
    .dark .auth-title {
      color: #58a6ff;
    }
    .auth-desc {
      color: var(--text-secondary);
      font-size: 1.08rem;
      margin-bottom: 1.5rem;
    }
    .dark .auth-desc {
      color: #bfc9d1;
    }
    .form-input {
      background: #fff;
      border: 1px solid #e5e7eb;
      color: var(--text-primary);
      border-radius: 9999px;
      padding: 1rem 1.3rem;
      font-size: 1.08rem;
      margin-bottom: 0.7rem;
      box-shadow: none;
      transition: border 0.2s, background 0.3s, color 0.3s;
    }
    .dark .form-input {
      background: #232946;
      border: 1px solid #30363d;
      color: #f9fafb;
    }
    .dark .form-input::placeholder {
      color: #bfc9d1;
      opacity: 1;
    }
    .form-input:focus {
      border-color: var(--brand-color);
      outline: none;
      background: #fff;
      color: var(--text-main);
    }
    .dark .form-input:focus {
      background: #232946;
      color: #fff;
    }
    .auth-btn {
      background: var(--brand-color);
      color: #fff;
      border: none;
      border-radius: 9999px;
      padding: 1rem 0;
      font-size: 1.12rem;
      font-weight: 600;
      width: 100%;
      margin-top: 0.2rem;
      margin-bottom: 0.2rem;
      cursor: pointer;
      transition: background 0.18s, transform 0.18s;
    }
    .dark .auth-btn {
      background: #2896d3;
      color: #fff;
    }
    .minimal-link {
      color: var(--brand-color);
      text-decoration: underline;
      background: none;
      border: none;
      padding: 0;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 0.2rem;
    }
    .dark .minimal-link {
      color: #58a6ff;
    }
    .auth-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      justify-content: center;
    }
    .auth-tab {
      background: none;
      border: none;
      font-size: 1.12rem;
      font-weight: 600;
      color: var(--text-secondary);
      padding: 0.6rem 1.5rem;
      border-radius: 9999px;
      cursor: pointer;
      transition: background 0.18s, color 0.18s;
    }
    .auth-tab[data-active="true"] {
      background: var(--brand-color);
      color: #fff;
    }
    .dark .auth-tab[data-active="true"] {
      background: #58a6ff;
      color: #181f2a;
    }
    #auth-success-message {
      margin-top: 0.7rem;
      font-size: 1.08rem;
      text-align: center;
    }
    .dark #auth-success-message {
      color: #7ee787;
    }
    .dark #auth-success-message.text-red-600 {
      color: #ff7b72 !important;
    }
    footer {
      margin-top: 2.5rem;
      color: var(--text-secondary);
      font-size: 1rem;
      text-align: center;
    }
    .dark footer {
      color: #bfc9d1;
    }
    @media (max-width: 700px) {
      #auth-card {
        padding: 1.2rem 0.5rem 1.5rem 0.5rem;
        max-width: 98vw;
      }
      .auth-title {
        font-size: 1.4rem;
      }
      .auth-tabs {
        flex-direction: column;
        gap: 0.2rem;
      }
      .auth-tab {
        width: 100%;
        text-align: center;
      }
    }
    @media (min-width: 1000px) {
      #auth-card {
        max-width: 480px;
        padding: 3.5rem 3.5rem 2.5rem 3.5rem;
      }
    }
  </style>
  <script>
    if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.classList.add('dark');
      document.documentElement.classList.remove('light');
    } else {
      document.documentElement.classList.add('light');
      document.documentElement.classList.remove('dark');
    }
    function toggleTheme() {
      const isDark = document.documentElement.classList.toggle('dark');
      document.documentElement.classList.toggle('light', !isDark);
      localStorage.setItem('color-theme', isDark ? 'dark' : 'light');
    }
  </script>
</head>
<body id="main-body" class="text-[var(--text-primary)] transition-colors duration-300 min-h-screen" style='font-family: "Plus Jakarta Sans", "Noto Sans", sans-serif;'>
  <div style="min-height:100vh;width:100vw;position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center;" class="px-2">
    <div id="bg-blobs">
      <div class="absolute -top-40 -left-40 h-96 w-96 rounded-full bg-[var(--pastel-blue)] opacity-30 blur-3xl dark:opacity-20 animate-[blob_20s_infinite]"></div>
      <div class="absolute -bottom-40 -right-40 h-96 w-96 rounded-full bg-[var(--pastel-pink)] opacity-30 blur-3xl dark:opacity-20 animate-[blob_20s_infinite]"></div>
    </div>
    <button id="theme-toggle-btn" aria-label="Toggle theme" style="position:fixed;top:32px;right:32px;z-index:50;background:none;border:none;outline:none;cursor:pointer;padding:8px;border-radius:50%;transition:background 0.15s;">
      <svg id="theme-toggle-dark-icon" class="hidden" width="26" height="26" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/></svg>
      <svg id="theme-toggle-light-icon" class="hidden" width="26" height="26" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zM4 10a6 6 0 1112 0A6 6 0 014 10z"/></svg>
    </button>
    <div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;width:100vw;min-height:80vh;z-index:10;">
      <div id="auth-card">
          <div class="auth-title">Code & Caffeine</div>
          <div class="auth-desc">Sign in or create an account to continue</div>
          <div class="auth-tabs">
            <button id="signInTab" class="auth-tab" type="button" data-active="true">Sign In</button>
            <button id="signUpTab" class="auth-tab" type="button" data-active="false">Sign Up</button>
          </div>
          <form id="signInForm" class="flex flex-col gap-4" autocomplete="on">
            <input name="email" type="email" required placeholder="Email" class="form-input w-full rounded-full border border-gray-300 bg-white/80 py-3 pl-5 pr-4 text-base text-gray-900 placeholder-gray-500 shadow-sm focus:border-[var(--brand-color)] focus:ring-1 focus:ring-[var(--brand-color)] backdrop-blur-sm" />
            <input name="password" type="password" required placeholder="Password" class="form-input w-full rounded-full border border-gray-300 bg-white/80 py-3 pl-5 pr-4 text-base text-gray-900 placeholder-gray-500 shadow-sm focus:border-[var(--brand-color)] focus:ring-1 focus:ring-[var(--brand-color)] backdrop-blur-sm" />
            <button type="submit" class="auth-btn">Sign In</button>
            <button type="button" id="forgotPasswordBtn" class="minimal-link mt-2">Forgot Password?</button>
          </form>
          <form id="signUpForm" class="flex flex-col gap-4 hidden" autocomplete="on">
            <input name="name" type="text" required placeholder="Name" class="form-input w-full rounded-full border border-gray-300 bg-white/80 py-3 pl-5 pr-4 text-base text-gray-900 placeholder-gray-500 shadow-sm focus:border-[var(--brand-color)] focus:ring-1 focus:ring-[var(--brand-color)] backdrop-blur-sm" />
            <input name="email" type="email" required placeholder="Email" class="form-input w-full rounded-full border border-gray-300 bg-white/80 py-3 pl-5 pr-4 text-base text-gray-900 placeholder-gray-500 shadow-sm focus:border-[var(--brand-color)] focus:ring-1 focus:ring-[var(--brand-color)] backdrop-blur-sm" />
            <input name="password" type="password" required placeholder="Password" class="form-input w-full rounded-full border border-gray-300 bg-white/80 py-3 pl-5 pr-4 text-base text-gray-900 placeholder-gray-500 shadow-sm focus:border-[var(--brand-color)] focus:ring-1 focus:ring-[var(--brand-color)] backdrop-blur-sm" />
            <input name="confirm-password" type="password" required placeholder="Confirm Password" class="form-input w-full rounded-full border border-gray-300 bg-white/80 py-3 pl-5 pr-4 text-base text-gray-900 placeholder-gray-500 shadow-sm focus:border-[var(--brand-color)] focus:ring-1 focus:ring-[var(--brand-color)] backdrop-blur-sm" />
            <button type="submit" class="auth-btn">Sign Up</button>
          </form>
          <form id="otpVerifyForm" class="flex flex-col gap-4 hidden" autocomplete="off">
            <input name="email" type="hidden" />
            <input name="otp" type="text" required placeholder="Enter OTP" maxlength="6" class="form-input w-full rounded-full border border-gray-300 bg-white/80 py-3 pl-5 pr-4 text-base text-gray-900 placeholder-gray-500 shadow-sm focus:border-[var(--brand-color)] focus:ring-1 focus:ring-[var(--brand-color)] backdrop-blur-sm" />
            <button type="submit" class="rounded-full bg-[var(--brand-color)] px-6 py-3 text-base font-semibold text-white shadow-lg transition-transform hover:scale-105 active:scale-100">Verify OTP</button>
            <button type="button" id="resendOtpBtn" class="text-sm text-[var(--brand-color)] hover:underline">Resend OTP</button>
          </form>
          <form id="forgotPasswordForm" class="flex flex-col gap-4 hidden" autocomplete="off">
            <input name="email" type="email" required placeholder="Enter your email" class="form-input w-full rounded-full border border-gray-300 bg-white/80 py-3 pl-5 pr-4 text-base text-gray-900 placeholder-gray-500 shadow-sm focus:border-[var(--brand-color)] focus:ring-1 focus:ring-[var(--brand-color)] backdrop-blur-sm" />
            <button type="submit" class="rounded-full bg-[var(--brand-color)] px-6 py-3 text-base font-semibold text-white shadow-lg transition-transform hover:scale-105 active:scale-100">Send OTP</button>
          </form>
          <form id="forgotOtpForm" class="flex flex-col gap-4 hidden" autocomplete="off">
            <input name="email" type="hidden" />
            <input name="otp" type="text" required placeholder="Enter OTP" maxlength="6" class="form-input w-full rounded-full border border-gray-300 bg-white/80 py-3 pl-5 pr-4 text-base text-gray-900 placeholder-gray-500 shadow-sm focus:border-[var(--brand-color)] focus:ring-1 focus:ring-[var(--brand-color)] backdrop-blur-sm" />
            <button type="submit" class="rounded-full bg-[var(--brand-color)] px-6 py-3 text-base font-semibold text-white shadow-lg transition-transform hover:scale-105 active:scale-100">Verify OTP</button>
          </form>
          <form id="resetPasswordForm" class="flex flex-col gap-4 hidden" autocomplete="off">
            <input name="email" type="hidden" />
            <input name="otp" type="hidden" />
            <input name="newPassword" type="password" required placeholder="Enter new password" class="form-input w-full rounded-full border border-gray-300 bg-white/80 py-3 pl-5 pr-4 text-base text-gray-900 placeholder-gray-500 shadow-sm focus:border-[var(--brand-color)] focus:ring-1 focus:ring-[var(--brand-color)] backdrop-blur-sm" />
            <button type="submit" class="rounded-full bg-[var(--brand-color)] px-6 py-3 text-base font-semibold text-white shadow-lg transition-transform hover:scale-105 active:scale-100">Reset Password</button>
          </form>
          <div id="auth-success-message" class="hidden text-green-600">Success!</div>
        </div>
      </div>
      <footer style="width:100vw;text-align:center;margin-top:2.5rem;color:var(--text-secondary);font-size:1rem;z-index:10;">
        Built with ☕ by <span style="font-weight:500; color:var(--text-primary);">Harshil Mittal</span>
      </footer>
    </div>
  </div>
  <script>
    // --- Theme toggle logic ---
    const themeToggleBtn = document.getElementById('theme-toggle-btn');
    const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
    const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');
    function setThemeIcons() {
      if (document.documentElement.classList.contains('dark')) {
        themeToggleLightIcon.classList.remove('hidden');
        themeToggleDarkIcon.classList.add('hidden');
      } else {
        themeToggleDarkIcon.classList.remove('hidden');
        themeToggleLightIcon.classList.add('hidden');
      }
    }
    function setThemeVars() {
      document.body.style.background = getComputedStyle(document.documentElement).getPropertyValue('--background-color');
    }
    function applyThemeFromStorage() {
      if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
        document.documentElement.classList.remove('light');
      } else {
        document.documentElement.classList.add('light');
        document.documentElement.classList.remove('dark');
      }
      setThemeIcons();
      setThemeVars();
    }
    applyThemeFromStorage();
    themeToggleBtn.addEventListener('click', function () {
      const isDark = document.documentElement.classList.toggle('dark');
      document.documentElement.classList.toggle('light', !isDark);
      localStorage.setItem('color-theme', isDark ? 'dark' : 'light');
      setThemeIcons();
      setThemeVars();
    });
    // Tab toggle logic
    const signInTab = document.getElementById('signInTab');
    const signUpTab = document.getElementById('signUpTab');
    const signInForm = document.getElementById('signInForm');
    const signUpForm = document.getElementById('signUpForm');
    const otpVerifyForm = document.getElementById('otpVerifyForm');
    const forgotPasswordForm = document.getElementById('forgotPasswordForm');
    const forgotOtpForm = document.getElementById('forgotOtpForm');
    const resetPasswordForm = document.getElementById('resetPasswordForm');
    const resendOtpBtn = document.getElementById('resendOtpBtn');

    signInTab.addEventListener('click', function () {
      signInTab.classList.add('text-white', 'bg-[var(--brand-color)]', 'border-[var(--brand-color)]');
      signInTab.classList.remove('text-[var(--text-secondary)]', 'bg-white');
      signInTab.setAttribute('data-active', 'true');
      signUpTab.classList.add('text-[var(--text-secondary)]', 'bg-white', 'border-transparent');
      signUpTab.classList.remove('text-white', 'bg-[var(--brand-color)]', 'border-[var(--brand-color)]');
      signUpTab.setAttribute('data-active', 'false');
      signInForm.classList.remove('hidden');
      signUpForm.classList.add('hidden');
      otpVerifyForm.classList.add('hidden');
      forgotPasswordForm.classList.add('hidden');
      forgotOtpForm.classList.add('hidden');
      resetPasswordForm.classList.add('hidden');
    });
    signUpTab.addEventListener('click', function () {
      signUpTab.classList.add('text-white', 'bg-[var(--brand-color)]', 'border-[var(--brand-color)]');
      signUpTab.classList.remove('text-[var(--text-secondary)]', 'bg-white');
      signUpTab.setAttribute('data-active', 'true');
      signInTab.classList.add('text-[var(--text-secondary)]', 'bg-white', 'border-transparent');
      signInTab.classList.remove('text-white', 'bg-[var(--brand-color)]', 'border-[var(--brand-color)]');
      signInTab.setAttribute('data-active', 'false');
      signUpForm.classList.remove('hidden');
      signInForm.classList.add('hidden');
      otpVerifyForm.classList.add('hidden');
      forgotPasswordForm.classList.add('hidden');
      forgotOtpForm.classList.add('hidden');
      resetPasswordForm.classList.add('hidden');
    });
    // Success message on submit
    const successMsg = document.getElementById('auth-success-message');
    function showMsg(msg, color = 'green') {
      successMsg.textContent = msg;
      successMsg.classList.remove('hidden');
      successMsg.classList.toggle('text-green-600', color === 'green');
      successMsg.classList.toggle('text-red-600', color === 'red');
    }
    function clearMsg() { successMsg.classList.add('hidden'); }

    // --- OTP and Forgot Password Logic ---
    // Show OTP form after signup
    signUpForm.addEventListener('submit', async function (e) {
      e.preventDefault();
      clearMsg();
      const form = e.target;
      const name = form.name.value.trim();
      const email = form.email.value.trim();
      const password = form.password.value;
      const confirm = form['confirm-password'].value;
      if (password !== confirm) {
        showMsg('Passwords do not match.', 'red');
        return;
      }
      form.querySelector('button[type="submit"]').disabled = true;
      showMsg('Signing up...', 'green');
      try {
        const res = await fetch('https://codeandcaffeine.onrender.com/api/signup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, email, password })
        });
        const data = await res.json();
        if (data.success) {
          showMsg('Signup successful! Please check your email for the OTP.', 'green');
          signUpForm.classList.add('hidden');
          otpVerifyForm.classList.remove('hidden');
          otpVerifyForm.email.value = email;
        } else {
          showMsg(data.error || 'Signup failed.', 'red');
        }
      } catch {
        showMsg('Network error. Try again.', 'red');
      }
      form.querySelector('button[type="submit"]').disabled = false;
    });

    otpVerifyForm.addEventListener('submit', async function (e) {
      e.preventDefault();
      clearMsg();
      const email = otpVerifyForm.email.value;
      const otp = otpVerifyForm.otp.value.trim();
      otpVerifyForm.querySelector('button[type="submit"]').disabled = true;
      showMsg('Verifying OTP...', 'green');
      try {
        const res = await fetch('https://codeandcaffeine.onrender.com/api/verify-otp', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, otp })
        });
        const data = await res.json();
        if (data.success) {
          showMsg('Email verified! You can now sign in.', 'green');
          otpVerifyForm.classList.add('hidden');
          signInForm.classList.remove('hidden');
        } else {
          showMsg(data.error || 'OTP verification failed.', 'red');
        }
      } catch {
        showMsg('Network error. Try again.', 'red');
      }
      otpVerifyForm.querySelector('button[type="submit"]').disabled = false;
    });

    resendOtpBtn.addEventListener('click', async function () {
      clearMsg();
      const email = otpVerifyForm.email.value;
      showMsg('Resending OTP...', 'green');
      try {
        const res = await fetch('https://codeandcaffeine.onrender.com/api/resend-otp', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email })
        });
        const data = await res.json();
        if (data.success) {
          showMsg('OTP resent to your email.', 'green');
        } else {
          showMsg(data.error || 'Failed to resend OTP.', 'red');
        }
      } catch {
        showMsg('Network error. Try again.', 'red');
      }
    });

    // Forgot Password Flow
    forgotPasswordBtn.addEventListener('click', function () {
      signInForm.classList.add('hidden');
      forgotPasswordForm.classList.remove('hidden');
    });

    forgotPasswordForm.addEventListener('submit', async function (e) {
      e.preventDefault();
      clearMsg();
      const email = forgotPasswordForm.email.value.trim();
      forgotPasswordForm.querySelector('button[type="submit"]').disabled = true;
      showMsg('Sending OTP...', 'green');
      try {
        const res = await fetch('https://codeandcaffeine.onrender.com/api/request-reset', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email })
        });
        const data = await res.json();
        if (data.success) {
          showMsg('OTP sent to your email.', 'green');
          forgotPasswordForm.classList.add('hidden');
          forgotOtpForm.classList.remove('hidden');
          forgotOtpForm.email.value = email;
        } else {
          showMsg(data.error || 'Failed to send OTP.', 'red');
        }
      } catch {
        showMsg('Network error. Try again.', 'red');
      }
      forgotPasswordForm.querySelector('button[type="submit"]').disabled = false;
    });

    forgotOtpForm.addEventListener('submit', async function (e) {
      e.preventDefault();
      clearMsg();
      const email = forgotOtpForm.email.value;
      const otp = forgotOtpForm.otp.value.trim();
      forgotOtpForm.querySelector('button[type="submit"]').disabled = true;
      showMsg('Verifying OTP...', 'green');
      try {
        const res = await fetch('https://codeandcaffeine.onrender.com/api/verify-reset-otp', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, otp })
        });
        const data = await res.json();
        if (data.success) {
          showMsg('OTP verified. Please enter your new password.', 'green');
          forgotOtpForm.classList.add('hidden');
          resetPasswordForm.classList.remove('hidden');
          resetPasswordForm.email.value = email;
          resetPasswordForm.otp.value = otp;
        } else {
          showMsg(data.error || 'OTP verification failed.', 'red');
        }
      } catch {
        showMsg('Network error. Try again.', 'red');
      }
      forgotOtpForm.querySelector('button[type="submit"]').disabled = false;
    });

    resetPasswordForm.addEventListener('submit', async function (e) {
      e.preventDefault();
      clearMsg();
      const email = resetPasswordForm.email.value;
      const otp = resetPasswordForm.otp.value;
      const newPassword = resetPasswordForm.newPassword.value;
      resetPasswordForm.querySelector('button[type="submit"]').disabled = true;
      showMsg('Resetting password...', 'green');
      try {
        const res = await fetch('https://codeandcaffeine.onrender.com/api/reset-password', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, otp, newPassword })
        });
        const data = await res.json();
        if (data.success) {
          showMsg('Password reset successful! You can now sign in.', 'green');
          resetPasswordForm.classList.add('hidden');
          signInForm.classList.remove('hidden');
        } else {
          showMsg(data.error || 'Password reset failed.', 'red');
        }
      } catch {
        showMsg('Network error. Try again.', 'red');
      }
      resetPasswordForm.querySelector('button[type="submit"]').disabled = false;
    });

    document.getElementById('signInForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      clearMsg();
      const form = e.target;
      const email = form.email.value.trim();
      const password = form.password.value;
      form.querySelector('button[type="submit"]').disabled = true;
      showMsg('Signing in...', 'green');
      try {
        const res = await fetch('https://codeandcaffeine.onrender.com/api/signin', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });
        const data = await res.json();
        if (data.success) {
          localStorage.setItem('token', data.token); // Save token after login
          localStorage.setItem('name', data.name || ''); // Save user name for greeting
          showMsg('Signed in successfully!', 'green');
          setTimeout(function() { window.location.href = 'planmysemester.html'; }, 1000);
        } else {
          showMsg(data.error || 'Sign in failed.', 'red');
        }
      } catch {
        showMsg('Network error. Try again.', 'red');
      }
      form.querySelector('button[type="submit"]').disabled = false;
    });
    // Helper to set background and blobs for light/dark mode
    function setBackgroundByTheme() {
      const isDark = document.documentElement.classList.contains('dark');
      const body = document.getElementById('main-body');
      const blobs = document.getElementById('bg-blobs');
      if (isDark) {
        body.style.background = 'linear-gradient(135deg, #232946 0%, #181f2a 60%, #2d3250 100%)';
        blobs.innerHTML = `
          <div class="absolute -top-40 -left-40 h-96 w-96 rounded-full bg-[#6a8caf] opacity-20 blur-3xl animate-[blob_20s_infinite]"></div>
          <div class="absolute -bottom-40 -right-40 h-96 w-96 rounded-full bg-[#b8a1c5] opacity-20 blur-3xl animate-[blob_20s_infinite]"></div>
          <div class="absolute top-1/3 left-1/2 -translate-x-1/2 h-40 w-40 rounded-full bg-[#232946]/40 opacity-40 blur-2xl"></div>
        `;
      } else {
        body.style.background = 'linear-gradient(135deg, #a3d5f1 0%, #f0f8ff 60%, #f5c8d1 100%)';
        blobs.innerHTML = `
          <div class="absolute -top-40 -left-40 h-96 w-96 rounded-full bg-[var(--pastel-blue)] opacity-30 blur-3xl animate-[blob_20s_infinite]"></div>
          <div class="absolute -bottom-40 -right-40 h-96 w-96 rounded-full bg-[var(--pastel-pink)] opacity-30 blur-3xl animate-[blob_20s_infinite]"></div>
          <div class="absolute top-1/3 left-1/2 -translate-x-1/2 h-40 w-40 rounded-full bg-white/40 opacity-40 blur-2xl"></div>
        `;
      }
    }
    // Initial set
    setBackgroundByTheme();
    // Also update on theme toggle
    const themeToggleBtn2 = document.querySelector('button[onclick="toggleTheme()"]');
    themeToggleBtn2.addEventListener('click', setBackgroundByTheme);
    // If theme is changed elsewhere (e.g. system), listen for class changes
    const observer = new MutationObserver(setBackgroundByTheme);
    observer.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });
  </script>
</body>
</html> 